<!doctype html>
<html lang="zxx" xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">
<head th:replace="common/head :: common_header(~{::title},~{::links},~{})">
    <title>sign-up</title>
</head>

<body>
<!--引入navbar-->
<div th:include="common/navbar :: navbar"></div>

<!-- Start Page Title Area -->
<div class="page-title-area item-bg-1">
    <div class="d-table">
        <div class="d-table-cell">
            <div class="container">
                <div class="page-title-content">
                    <h2>Sign Up</h2>
                    <ul>
                        <li><a th:href="@{/index.html}" href="index.html">Home</a></li>
                        <li>Sign Up</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- End Page Title Area -->

<!-- Start Signup Area -->
<div class="signup-area ptb-100">
    <div class="container">
        <div class="signup-form">
            <h3>人脸识别</h3>
            <div class="row">


                <div class="col-lg-12">
                    <div class="form-group">
                        <input class="form-control" placeholder="在此输入姓名" type="text" name="userName" id="userName">
                    </div>
                    <div id="mainDiv">

                    </div>
                    <div>
                        <table frame="void">
                            <tr>
                                <div class="col-lg-12">
                                    <div class="send-btn">
                                        <button class="default-btn" title="摄像头注册" value="摄像头注册" onclick="getMedia()">
                                            摄像头注册
                                            <span></span>
                                        </button>
                                    </div>
                                </div>
                            </tr>
                            <tr>
                                <div class="col-lg-12">
                                    <div class="send-btn">
                                        <button class="default-btn" id="snap" onclick="takePhoto()">
                                            提交
                                            <span></span>
                                        </button>
                                    </div>
                                    <br>
                                    <span>已经注册人脸? <a th:href="@{/spot}" href="face-recognition.html.html">前往验证!</a></span>
                                </div>
                            </tr>
                        </table>
                    </div>
                </div>


            </div>
        </div>
        </form>
    </div>
</div>
</div>
<!-- End Signup Area -->

<!-- Start Footer Area -->
<section class="footer-area pt-100 pb-70">
    <div class="container">
        <div class="row">
            <div class="col-lg-3 col-md-6">
                <div class="single-footer-widget">
                    <div class="logo">
                        <a href="#">
                            <img th:src="@{/assets/img/logo2.png}" src="assets/img/logo2.png" alt="image">
                        </a>
                    </div>
                    <p>平安袋是银行为客户提供的个人无担保、无抵押的信用贷款，额度为1万-50万，用于个人或家庭除购买住房以外其他消费或经营用途。手续齐全，1-3个工作日即可放款。</p>
                    <ul class="social">
                        <li>
                            <b>跟随我们:</b>
                        </li>

                        <li>
                            <a href="#" target="_blank">
                                <i class="flaticon-twitter"></i>
                            </a>
                        </li>

                        <li>
                            <a href="#" target="_blank">
                                <i class="flaticon-instagram"></i>
                            </a>
                        </li>

                        <li>
                            <a href="#" target="_blank">
                                <i class="flaticon-facebook"></i>
                            </a>
                        </li>

                        <li>
                            <a href="#" target="_blank">
                                <i class="flaticon-linkedin"></i>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>

            <div class="col-lg-3 col-md-6">
                <div class="single-footer-widget">
                    <h3>快速链接</h3>

                    <ul class="quick-links">
                        <li>
                            <a href="about.html">关于</a>
                        </li>
                        <li>
                            <a href="#">我们的表现</a>
                        </li>
                        <li>
                            <a href="faq.html">常见问题</a>
                        </li>
                        <li>
                            <a href="news.html">博客</a>
                        </li>
                        <li>
                            <a th:href="@{/contact}">联系我们</a>
                        </li>
                    </ul>
                </div>
            </div>

            <div class="col-lg-3 col-md-6">
                <div class="single-footer-widget">
                    <h3>其他资源</h3>

                    <ul class="quick-links">
                        <li>
                            <a href="#">支持</a>
                        </li>
                        <li>
                            <a href="privacy-policy.html">隐私政策</a>
                        </li>
                        <li>
                            <a href="terms-condition.html">服务条款</a>
                        </li>
                        <li>
                            <a href="#">商业贷款</a>
                        </li>
                        <li>
                            <a href="#">贷款服务</a>
                        </li>
                    </ul>
                </div>
            </div>

            <div class="col-lg-3 col-md-6">
                <div class="single-footer-widget">
                    <h3>联系我们</h3>

                    <div class="info-contact">
                        <i class="flaticon-pin"></i>
                        <span>6890 Blvd, The Bronx, NY 1058 New York, USA</span>
                    </div>

                    <div class="info-contact">
                        <i class="flaticon-mail"></i>
                        <span>
                                <a href="mailto:hello@finix.com">hello@finix.com</a>
                            </span>
                        <span>
                                <a href="#">Skype: example</a>
                            </span>
                    </div>

                    <div class="info-contact">
                        <i class="flaticon-telephone"></i>
                        <span>
                                <a href="tel:1514312-6688">+1 (514) 312-5678</a>
                            </span>
                        <span>
                                <a href="tel:1514312-6688">+1 (514) 312-6688</a>
                            </span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- End Footer Area -->

<!-- Start Copy Right Area -->
<div class="copy-right-area">
    <div class="container">
        <div class="copy-right-content">
            <p>
                &copy;版权和副本:2022苍盐海 版权所有.
            </p>
        </div>
    </div>
</div>
<!-- End Copy Right Area -->

<!-- Start Go Top Area -->
<div class="go-top">
    <i class='bx bx-chevron-up'></i>
</div>
<!-- End Go Top Area -->


<!--弹框start-->
<div class="modal fade" id="MyModal" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true"
     data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="myModalLabel">提示</h4>
                <!--<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>-->
            </div>
            <div class="modal-body">
                <p id="ModalContext">内容</p>
            </div>
            <div class="modal-footer">
                <button onclick="location.href=('/index')" type="button" class="btn btn-primary">确定</button>
            </div>
        </div>
    </div>
</div>


<!-- Jquery Slim JS -->
<script th:src="@{/assets/js/jquery.min.js}" src="assets/js/jquery.min.js"></script>
<!-- Popper JS -->
<script th:src="@{/assets/js/popper.min.js}" src="assets/js/popper.min.js"></script>
<!-- Bootstrap JS -->
<script th:src="@{/assets/js/bootstrap.min.js}" src="assets/js/bootstrap.min.js"></script>
<!-- Meanmenu JS -->
<script th:src="@{/assets/js/jquery.meanmenu.js}" src="assets/js/jquery.meanmenu.js"></script>
<!-- Carousel JS -->
<script th:src="@{/assets/js/owl.carousel.min.js}" src="assets/js/owl.carousel.min.js"></script>
<!-- Nice Select JS -->
<script th:src="@{/assets/js/jquery.nice-select.min.js}" src="assets/js/jquery.nice-select.min.js"></script>
<!-- Magnific Popup JS -->
<script th:src="@{/assets/js/jquery.magnific-popup.min.js}" src="assets/js/jquery.magnific-popup.min.js"></script>
<!-- Odometer JS -->
<script th:src="@{/assets/js/odometer.min.js}" src="assets/js/odometer.min.js"></script>
<!-- Appear JS -->
<script th:src="@{/assets/js/jquery.appear.js}" src="assets/js/jquery.appear.js"></script>
<!-- Form Ajaxchimp JS -->
<script th:src="@{/assets/js/jquery.ajaxchimp.min.js}" src="assets/js/jquery.ajaxchimp.min.js"></script>
<!-- Form Validator JS -->
<script th:src="@{/assets/js/form-validator.min.js}" src="assets/js/form-validator.min.js"></script>
<!-- Contact JS -->
<script th:src="@{/assets/js/contact-form-script.js}" src="assets/js/contact-form-script.js"></script>
<!-- Wow JS -->
<script th:src="@{/assets/js/wow.min.js}" src="assets/js/wow.min.js"></script>
<!-- Custom JS -->
<script th:src="@{/assets/js/main.js}" src="assets/js/main.js"></script>
</body>
</html>
<script>
    function getMedia() {
        $("#mainDiv").empty();
        let videoComp = " <video id='video' width='500px' height='500px' autoplay='autoplay' style='margin-top: 20px'></video><canvas id='canvas' width='500px' height='500px' style='display: none'></canvas>";
        $("#mainDiv").append(videoComp);

        let constraints = {
            video: {width: 500, height: 500},
            audio: true
        };
        //获得video摄像头区域
        let video = document.getElementById("video");
        //这里介绍新的方法，返回一个 Promise对象
        // 这个Promise对象返回成功后的回调函数带一个 MediaStream 对象作为其参数
        // then()是Promise对象里的方法
        // then()方法是异步执行，当then()前的方法执行完后再执行then()内部的程序
        // 避免数据没有获取到
        let promise = navigator.mediaDevices.getUserMedia(constraints);
        promise.then(function (MediaStream) {
            video.srcObject = MediaStream;
            video.play();
        });

        // var t1 = window.setTimeout(function() {
        //     takePhoto();
        // },2000)
    }

    //拍照事件
    function takePhoto() {
        let mainComp = $("#mainDiv");
        if (mainComp.has('video').length) {
            alert(111)
            let userNameInput = $("#userName").val();
            if (userNameInput == "") {
                alert("姓名不能为空!");
                return false;
            }
            //获得Canvas对象
            let video = document.getElementById("video");
            let canvas = document.getElementById("canvas");
            let ctx = canvas.getContext('2d');
            ctx.drawImage(video, 0, 0, 500, 500);
            var formData = new FormData();
            var base64File = canvas.toDataURL();
            var userName = $("#userName").val();
            formData.append("file", base64File);
            formData.append("name", userName);
            formData.append("groupId", "101");
            $.ajax({
                type: "post",
                url: "/faceAdd",
                data: formData,
                contentType: false,
                processData: false,
                async: false,
                success: function (text) {
                    alert(222)
                    var res = JSON.stringify(text)
                    if (text.code == 0) {
                        alert("注册成功")
                    } else {
                        alert(text.message)
                    }
                },
                error: function (error) {
                    alert(JSON.stringify(error))
                }
            });
        } else {
            alert(333)
            var formData = new FormData();
            let userName = $("#userName").val();
            formData.append("groupId", "101");
            var file = $("#file0")[0].files[0];
            var reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = function () {
                var base64 = reader.result;
                formData.append("file", base64);
                formData.append("name", userName);
                $.ajax({
                    type: "post",
                    url: "/faceAdd",
                    data: formData,
                    contentType: false,
                    processData: false,
                    async: false,
                    success: function (text) {
                        alert(444)
                        var res = JSON.stringify(text)
                        if (text.code == 0) {
                            alert("注册成功")
                        } else {
                            alert(text.message)
                        }
                    },
                    error: function (error) {
                        alert(JSON.stringify(error))
                    }
                });
                location.reload();
            }
        }

    }


</script>
